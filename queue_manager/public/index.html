<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ALPEN.BOT SONGQ</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
<div id="setup-guard" class="setup-guard" hidden></div>
<div id="login-status" class="status-bar" style="display:none">
  <div class="status-user">
    <div id="login-avatar" class="status-avatar" aria-hidden="true"></div>
    <div class="status-info">
      <span id="login-name" class="status-name"></span>
      <span id="login-channel" class="status-channel"></span>
    </div>
  </div>
  <div class="status-actions">
    <button id="logout-btn" class="status-action">log out</button>
    <button id="logout-perm-btn" class="status-action danger">forget &amp; log out</button>
  </div>
</div>
<div id="landing" class="landing">
  <div class="dev-stamp" id="qm-landing-dev-stamp" hidden aria-hidden="true">DEV</div>
  <h1>ALPEN.BOT SONGQ</h1>
  <button id="login-btn">log in with Twitch</button>
  <div id="channel-list" class="channel-list"></div>
</div>

<div id="app" style="display:none">
  <div class="wrap">
    <div class="header">
      <div class="brand">Queue Manager</div>
      <span id="ch-badge" class="badge">channel: ?</span>
      <span id="bot-status" class="badge" hidden>bot: unknown</span>
      <button id="reg-btn" style="display:none"></button>
      <div class="dev-stamp" id="qm-app-dev-stamp" hidden aria-hidden="true">DEV</div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="tabs">
          <button id="tab-queue" class="tab active">Queue</button>
          <button id="tab-playlists" class="tab">Playlists</button>
          <button id="tab-users" class="tab">Users</button>
          <button id="tab-settings" class="tab">Settings</button>
          <button id="tab-events" class="tab">streamer.bot</button>
          <button id="tab-overlays" class="tab">Overlays</button>
          <button id="tab-dev" class="tab" hidden>Dev</button>
        </div>

        <div id="queue-view">
          <div class="queue-layout">
            <div class="preview-column">
              <div class="preview-card">
                <div class="section-header">
                  <h3 class="section-title">YouTube Preview</h3>
                  <button id="preview-toggle" class="collapse-toggle" type="button" aria-expanded="true" aria-controls="preview-content">Hide preview</button>
                </div>
                <div id="preview-content" class="collapsible-content">
                  <div id="preview-video" class="preview-video empty">
                    <iframe id="preview-frame" title="YouTube preview" src="about:blank" loading="lazy" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                    <div id="preview-message" class="preview-message">Select a request to load YouTube Music matches.</div>
                  </div>
                  <div class="preview-link-group">
                    <label for="preview-url">Video link</label>
                    <div class="preview-link-row">
                      <input id="preview-url" type="text" value="" readonly aria-readonly="true"/>
                      <button id="preview-copy" type="button" disabled>Copy</button>
                    </div>
                  </div>
                  <div class="preview-results">
                    <div class="preview-results-header">
                      <span class="preview-results-title">YouTube Music results</span>
                      <span id="preview-status" class="preview-status muted"></span>
                    </div>
                    <div id="preview-results" class="preview-results-list"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="queue-column">
              <div class="section-header">
                <h2 class="section-title">Active Queue</h2>
                <button id="queue-toggle" class="collapse-toggle" type="button" aria-expanded="true" aria-controls="queue-content">Hide queue</button>
              </div>
              <div id="queue-content" class="collapsible-content">
                <div id="queue" class="queue"></div>
              </div>
            </div>
          </div>
          <div class="footer">
            <button id="archive-btn">Archive Stream</button>
            <button id="mute-btn">Toggle Requests</button>
          </div>
        </div>

        <div id="playlists-view" style="display:none">
          <h2>Playlists</h2>
          <form id="playlist-form" class="playlist-form">
            <fieldset class="playlist-mode">
              <legend class="playlist-mode-legend">Playlist source</legend>
              <div class="playlist-mode-options">
                <label class="playlist-mode-option">
                  <input type="radio" name="playlist-mode" value="import" checked />
                  <span class="playlist-mode-label">Import from YouTube</span>
                  <span class="playlist-mode-hint">Sync songs from an existing playlist link.</span>
                </label>
                <label class="playlist-mode-option">
                  <input type="radio" name="playlist-mode" value="manual" />
                  <span class="playlist-mode-label">Create empty playlist</span>
                  <span class="playlist-mode-hint">Start fresh and add songs manually.</span>
                </label>
              </div>
            </fieldset>
            <div class="playlist-form-section" data-playlist-mode="import">
              <div class="playlist-form-row">
                <label for="playlist-url">YouTube playlist link</label>
                <input id="playlist-url" type="url" placeholder="https://www.youtube.com/playlist?list=..." />
              </div>
            </div>
            <div class="playlist-form-section" data-playlist-mode="manual" hidden>
              <div class="playlist-form-row">
                <label for="playlist-title">Playlist title</label>
                <input id="playlist-title" type="text" maxlength="255" placeholder="Late Night Vibes" autocomplete="off" />
              </div>
            </div>
            <div class="playlist-form-row">
              <label for="playlist-visibility">Visibility</label>
              <select id="playlist-visibility">
                <option value="public" selected>Public</option>
                <option value="unlisted">Unlisted</option>
              </select>
            </div>
            <div class="playlist-form-row">
              <label for="playlist-keywords">Keywords</label>
              <input id="playlist-keywords" type="text" placeholder="Separate with commas or spaces" />
              <p class="muted playlist-form-hint">Use commas or spaces to enter multiple keywords. Chat can request them with <code>!random keyword</code>.</p>
            </div>
            <div class="playlist-form-actions">
              <button type="submit">Save playlist</button>
              <span id="playlist-status" class="playlist-status muted" role="status">Import from YouTube or create a manual playlist to curate your queue.</span>
            </div>
          </form>
          <div id="playlists" class="playlists-list"></div>
        </div>

        <div id="users-view" style="display:none">
          <h2>Users</h2>
          <div id="users" class="queue"></div>
        </div>

        <div id="settings-view" style="display:none">
          <h2>Settings</h2>
          <div id="channel-key-card" class="channel-key-card">
            <div class="channel-key-header">
              <div class="channel-key-info">
                <h3 class="channel-key-title">Channel API key</h3>
                <p class="muted">Share this secret only with trusted tools. Add it to channel-safe API calls as the <code>X-Channel-Key</code> header or a <code>channel_key</code> query parameter.</p>
                <p class="muted channel-key-hint">Queue Manager uses <code>BACKEND_URL</code> and <code>TWITCH_SCOPES</code> from <code>public/config.js</code> to reach the endpoints above.</p>
              </div>
              <div class="channel-key-actions">
                <button id="channel-key-show" type="button">Show key</button>
                <button id="channel-key-copy" type="button" disabled>Copy</button>
                <button id="channel-key-regenerate" type="button">Regenerate</button>
              </div>
            </div>
            <div id="channel-key-secret" class="channel-key-secret" aria-live="polite">Select a channel to load its key.</div>
            <div id="channel-key-status" class="channel-key-status muted" role="status"></div>
          </div>
          <div id="settings"></div>
        </div>

        <div id="events-view" style="display:none">
          <div class="events-header">
            <h2 class="section-title">streamer.bot</h2>
            <div class="events-controls">
              <span id="event-status" class="event-status">Disconnected</span>
              <label class="event-autoscroll">
                <input id="event-autoscroll" type="checkbox" checked />
                Auto-scroll
              </label>
              <button id="event-clear" type="button">Clear</button>
            </div>
          </div>
          <div id="event-feed" class="event-feed" role="log" aria-live="polite" aria-relevant="additions"></div>
          <div class="streamerbot-notes">
            <label for="streamerbot-notes-field">streamer.bot usage instructions</label>
            <textarea id="streamerbot-notes-field" placeholder="Document how streamer.bot should interact with this channel." aria-label="streamer.bot usage instructions"></textarea>
            <p class="muted">Leave guidance here for future automation recipes. Content can be filled in later.</p>
          </div>
          <div id="streamerbot-shortcuts" class="streamerbot-shortcuts">
            <div class="section-header">
              <h3 class="section-title">streamer.bot API shortcuts</h3>
              <span id="streamerbot-shortcuts-status" class="muted">Select a channel to build API links.</span>
            </div>
            <div id="streamerbot-shortcut-list" class="streamerbot-shortcut-list"></div>
          </div>
        </div>

        <div id="overlays-view" style="display:none">
          <h2>Overlay Builder</h2>
          <p class="muted">Design OBS browser sources that stay in sync with your live queue and channel events. Choose an overlay family, customize the options, and copy the generated link.</p>
          <div class="overlay-builder" aria-live="polite">
            <div class="overlay-controls">
              <div id="overlay-channel-warning" class="overlay-warning" hidden>Select a channel to generate overlay links.</div>
              <label>
                Overlay type
                <select id="overlay-kind">
                  <option value="queue">Queue overlay</option>
                  <option value="events">Event overlay</option>
                </select>
              </label>
              <label id="overlay-layout-wrapper">
                <span id="overlay-layout-label">Overlay size &amp; layout</span>
                <select id="overlay-layout"></select>
              </label>
              <label id="overlay-detail-wrapper" hidden>
                Detail level
                <select id="overlay-detail">
                  <option value="minimal">Minimal</option>
                  <option value="summary" selected>Summary</option>
                  <option value="full">Full</option>
                </select>
              </label>
              <label id="overlay-scale-wrapper" hidden>
                Size scaling
                <select id="overlay-scale">
                  <option value="90">90%</option>
                  <option value="100" selected>100%</option>
                  <option value="115">115%</option>
                  <option value="130">130%</option>
                </select>
              </label>
              <label>
                Color scheme
                <select id="overlay-theme">
                  <option value="violet">Midnight Violet</option>
                  <option value="ocean">Nordic Ocean</option>
                  <option value="sunset">Evening Sunset</option>
                  <option value="mint">Aurora Mint</option>
                </select>
              </label>
              <div class="overlay-link-group">
                <label for="overlay-url">Overlay link</label>
                <div class="overlay-link-row">
                  <input id="overlay-url" type="text" readonly value="" aria-readonly="true"/>
                  <button id="overlay-copy" type="button">Copy</button>
                </div>
                <div id="overlay-dimensions" class="overlay-dimensions muted"></div>
              </div>
            </div>
            <div class="overlay-preview">
              <div class="overlay-preview-frame">
                <iframe id="overlay-preview" title="Overlay preview" loading="lazy"></iframe>
                <div class="overlay-preview-hints">
                  <div class="overlay-preview-hint muted" data-overlay-family-hint="queue">Preview background is transparent in OBS. Queue overlays update whenever the song list changes.</div>
                  <div class="overlay-preview-hint muted" data-overlay-family-hint="events" hidden>Preview background is transparent in OBS. Event overlays animate when new alerts arrive.</div>
                </div>
              </div>
            </div>
          </div>
          <p class="overlay-hint muted">Add a new Browser Source in OBS, paste the link, and use the recommended size. The overlay updates itself whenever your channel data changes.</p>
        </div>

        <div id="dev-view" class="dev-view" style="display:none">
          <h2>Developer Notes</h2>
          <p class="dev-placeholder">
            <h3>v0.1.0 first public deployment</h3>
            <hr>
            <h4>known shit</h4>
            <p>- t1/t2/t3 subscriber behaviour is weird</p>
            <p>- archive behaiour</p>
            <p>- bot doesn't greet, but says goodbye</p>
            <p>- bot console window</p>
            <hr>
            <h4>shit to do</h4>
            <p>- bot not customizeable: messages and aliases of commands</p>
            <p>- lots settings and lots of "bump" options not adjustable yet</p>
            <p>- bits and channelpoints not implemented</p>            
            <p>- instructions for streamer.bot</p>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<footer class="app-footer" id="manager-footer" hidden></footer>

  <script src="config.js"></script>
  <script src="queue_manager.js"></script>
<div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="false"></div>
<div id="playlist-picker" class="playlist-picker" hidden>
  <div class="playlist-picker-dialog" role="dialog" aria-modal="true" aria-labelledby="playlist-picker-title">
    <h3 id="playlist-picker-title">Add to playlist</h3>
    <p id="playlist-picker-subtitle" class="muted">Choose a manual playlist for the selected song.</p>
    <label class="playlist-picker-label" for="playlist-picker-select">
      Playlist
      <select id="playlist-picker-select" aria-describedby="playlist-picker-subtitle"></select>
    </label>
    <div class="playlist-picker-actions">
      <button type="button" id="playlist-picker-cancel">Cancel</button>
      <button type="button" id="playlist-picker-confirm" class="accent">Add song</button>
    </div>
  </div>
</div>
</body>
</html>
